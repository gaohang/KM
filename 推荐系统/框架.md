# 推荐流程

## 1.  Match 

​                               

在SearchEngine 中，X2I、itemInfo、User Trigger数据周期（天/小时级别）更新。其中，User Trigger包括（点击、加购、收藏、下单）的item、category、shop、brand，user tag等。

**召回步骤**

1)  利用userid/utdid获取用户Trigger。

2)  利用Trigger和X2I矩阵进行join完成对商品的召回。

3)  在商品召回中一般以I2I关系矩阵召回的商品为主，其他X2I关系矩阵召回为辅助。

4)  截断多路召回中，需要对每一路的召回数量进行约束。当Trigger过多时，可以对Triggle进行截断。

## 2.  Filter

对召回商品进行去重，过滤购买过的商品，剔除过度曝光的商品。

## 3.  Rank

打分阶段利用itemInfo和不同算法指标对商品多个维度打分。

## 4.  Rule

进行商品排序，根据规则对商品多个维度的分数进行综合排序。

# 关键技术

## 1.  冷启动

#### user冷启动

（user cluster based / user-profiled based / user-tag based）hot item

#### Item冷启动

Embedding based 



## 2.  Match模型

基于行为：cf-based 从用户标签中获取trigger，然后使用 i2i偏重个性化（淘宝商品）或 u2i偏重群效应（头条热点新闻）；swing 算法

基于内容：content-based

融合行为和内容：embedding 1）MF、FM 2）w2v、DSSM

## 3.  rank模型

lr fm（ftrl）

gbdt

dnn

 

## 4.  特征工程

排序模型包括三大类特征及其交叉

·   Item 维度的特征

基本：itemId、cate、brand、saler

标签：价格标签、风格标签

统计：包括价格、折扣、评分、类别 和 历史点击率、销量等。例如，对于销量比较高的 Item，用户再去点和买的概率也更高。评分较高的 Item，更受用户欢迎。

·   user维度的特征

基本：人口属性、客户端类型。

标签：User tag、购买力、baby年龄

统计：用户行为的长中短期统计，例如 近1个月加购（且未购买的）item id

不同用户有不同偏好，例如有些喜欢看电影，有些喜欢点外卖。另外，人口属性也会对推荐的内容有影响，比如某用户是一位男性，那给他推荐美甲美容可能就不太合适。若为LBS推荐，还应包括常去地理位置、工作地、居住地等

·   user和 Item 的交叉特征

包括用户对 Item 的点击、收藏、购买等。例如，籍贯-四川 与 菜品种类-火锅。

·   context

包括本地、异地，是否周末、节假日，天气因素等特征。例如，在节假日，酒店和旅游的需求会更多。如果当前天气不太好，比如大雨或者下雪了，人们不愿意出去吃饭，这个时候外卖的需求就会增多。若为LBS推荐，还应包括用户实时位置与 POI 的距离。

## 5.  样本选择

·   如何选择得到训练数据中的正例和负例？正例一般是用户产生点击、下单等转换行为的样本。没有转换行为的样本是否就一定是负例呢？其实不然，很多展现用户根本没看到。因此把这样的样本视为负例不合理。常用方法是 Skip-Above，即被点击 Item 位置以上的展现才可能视作负例。当然，上面介绍的方法中的负例都是隐式的负反馈数据。除此之外，还有用户主动删除的显式反馈数据，这些数据是高质量的负例。

·   曝光数据的应用。Skip-Above 的一个问题是，我们在构建训练样本时，只保留了有用户点击的 Session 中的样本，没有点击 Session 中的负样本都丢弃掉了。而点击样本对应的用户往往偏活跃。这造成一个问题：最终训练集分布会更偏向于有点击的活跃用户。为了解决这个问题，可以使用实际给用户曝光的数据。例如，在 App 中埋点跟踪曝光。将有曝光但没点的样本。最终的训练数据更符合实际线上数据的分布，实际的线上效果也得到了验证。

·   样本去噪。对于数据中混杂的刷单等类作弊行为的数据，要将其排除出训练数据，否则它会直接影响模型的效果。

·   样本采样和样本权重。对于点击率预估而言，正负样本严重不均衡，所以需要对负例做一些采样。 用户不同的操作行为，代表着对推荐结果的不同反馈程度。如点击、下单、支付体现了从用户弱到强的认可度 。样本（loss）权重设置如下：支付样本的权重 > 下单样本权重 > 点击样本权重。

 

 

 

 

 

 

# 其他

## 场景回放/ ABTest

场景回放：要记录context特征、召回策略、精排策略及得分

ABtest：  

 

## 多目标

Ctr cvr

[**Recommending What Video to Watch Next: A Multitask Ranking System**](https://link.zhihu.com/?target=https%3A//dl.acm.org/citation.cfm%3Fid%3D3346997)

 

## 推荐系统评价指标

 

 